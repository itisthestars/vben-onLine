var Ue=Object.defineProperty;var we=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var Ie=(s,l,a)=>l in s?Ue(s,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[l]=a,L=(s,l)=>{for(var a in l||(l={}))We.call(l,a)&&Ie(s,a,l[a]);if(we)for(var a of we(l))Ye.call(l,a)&&Ie(s,a,l[a]);return s};var x=(s,l,a)=>new Promise((c,v)=>{var y=u=>{try{F(a.next(u))}catch(d){v(d)}},f=u=>{try{F(a.throw(u))}catch(d){v(d)}},F=u=>u.done?c(u.value):Promise.resolve(u.value).then(y,f);F((a=a.apply(s,l)).next())});import{u as t,c as q,w as ae,an as Ge,y as pe,g as Xe,J as Te,h as qe,d as Je,K as ke,r as Be,f as se,o as ze,a3 as De,V as me,a8 as Ae,al as Ze,a6 as le,G as Qe,k as Ee,Z as Oe,_ as je,a0 as ue,U as Me,F as et,a4 as ye,aj as xe}from"./vue-CZYcLuVH.js";import{_ as tt}from"./FormItem.vue_vue_type_script_lang-gXjHvygV.js";import{b as nt,c as st,_ as at}from"./BasicForm.vue_vue_type_style_index_0_lang-DQUhReNk.js";import{u as it,i as fe,d as Se,a as ot}from"./helper-MM8B7jAV.js";import{H as Y,I as J,J as G,G as rt,K as ve,d as Ke,f as ct,u as lt}from"./entry/index-VJM-_B3m.js";import{f as k,j as M,h as z,n as de,s as ee,af as Q,ai as _e,x as $e,ac as ut,aj as Le,ak as ft,al as dt,a4 as pt,W as ht}from"./antd-BA4tRdrP.js";import{u as mt}from"./index-CrJR8h6z.js";function At(s,l,a){const c=/^\[(.+)\]$/;if(c.test(s)){const v=s.match(c);if(v&&v[1]){const y=v[1].split(",");return l=Array.isArray(l)?l:[l],y.forEach((f,F)=>{ee(a,f.trim(),l[F])}),!0}}}function yt(s,l,a){const c=/^\{(.+)\}$/;if(c.test(s)){const v=s.match(c);if(v&&v[1]){const y=v[1].split(",");return l=Y(l)?l:{},y.forEach(f=>{ee(a,f.trim(),l[f.trim()])}),!0}}}function vt({defaultValueRef:s,getSchema:l,formModel:a,getProps:c}){function v(u){var g,B;if(!Y(u))return{};const d={};for(const D of Object.entries(u)){let[,r]=D;const[T]=D;if(!T||J(r)&&r.length===0||z(r))continue;const i=t(c).transformDateFunc;Y(r)&&(r=i==null?void 0:i(r)),J(r)&&((g=r[0])!=null&&g.format)&&((B=r[1])!=null&&B.format)&&(r=r.map(b=>i==null?void 0:i(b))),de(r)&&(r=r.trim()),!At(T,r,d)&&!yt(T,r,d)&&ee(d,T,r)}return y(d)}function y(u){const d=t(c).fieldMapToTime;if(!d||!Array.isArray(d))return u;for(const[g,[B,D],r="YYYY-MM-DD"]of d){if(!g||!B||!D)continue;if(!Q(u,g)){_e(u,g);continue}const[T,i]=Q(u,g),[b,S]=Array.isArray(r)?r:[r,r];!k(T)&&!$e(T)&&ee(u,B,f(T,b)),!k(i)&&!$e(i)&&ee(u,D,f(i,S)),_e(u,g)}return u}function f(u,d){return d==="timestamp"?G(u).unix():d==="timestampStartDay"?G(u).startOf("day").unix():G(u).format(d)}function F(){const u=t(l),d={};u.forEach(g=>{const{defaultValue:B,defaultValueObj:D,componentProps:r={}}=g,T=Object.keys(D||{});T.length&&T.forEach(i=>{d[i]=D[i],a[i]===void 0&&(a[i]=D[i])}),k(B)||(d[g.field]=B,a[g.field]===void 0&&(a[g.field]=B)),k(r==null?void 0:r.defaultValue)||(d[g.field]=r==null?void 0:r.defaultValue,a[g.field]===void 0&&(a[g.field]=r==null?void 0:r.defaultValue))}),s.value=M(d)}return{handleFormValues:v,initDefault:F}}const X=24;function gt({advanceState:s,emit:l,getProps:a,getSchema:c,formModel:v,defaultValueRef:y}){const f=Xe(),{realWidthRef:F,screenEnum:u,screenRef:d}=rt(),g=q(()=>{if(!s.isAdvanced)return 0;const i=t(a).emptySpan||0;if(ut(i))return i;if(Y(i)){const{span:b=0}=i,S=t(d);return i[S.toLowerCase()]||b||0}return 0});ae([()=>t(c),()=>s.isAdvanced,()=>t(F)],()=>{const{showAdvancedButton:i}=t(a);i&&pe(()=>{r()})},{immediate:!0});function B(i,b=0,S=!1){const K=t(F),j=parseInt(i.md)||parseInt(i.xs)||parseInt(i.sm)||i.span||X,$=parseInt(i.lg)||j,R=parseInt(i.xl)||$,N=parseInt(i.xxl)||R;return K<=u.LG?b+=j:K<u.XL?b+=$:K<u.XXL?b+=R:b+=N,S?(s.hideAdvanceBtn=!1,b<=X*2?(s.hideAdvanceBtn=!0,s.isAdvanced=!0):b>X*2&&b<=X*(t(a).autoAdvancedLine||3)?s.hideAdvanceBtn=!1:s.isLoad||(s.isLoad=!0,s.isAdvanced=!s.isAdvanced),{isAdvanced:s.isAdvanced,itemColSum:b}):b>X*(t(a).alwaysShowLines||1)?{isAdvanced:s.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const D=Ge({});function r(){var K;let i=0,b=0;const{baseColProps:S={}}=t(a);for(const j of t(c)){const{show:$,ifShow:R,colProps:N}=j,H={schema:j,model:v,field:j.field,values:L(L({},t(y)),v)};let O=!0;if(O&&Le(R)&&(O=R),O&&z(R)&&(O=R(H)),O&&Le($)&&(O=$),O&&z($)&&(O=$(H)),O&&(N||S)){const{itemColSum:W,isAdvanced:Z}=B(L(L({},S),N),i);i=W||0,Z&&(b=i),D[j.field]=Z}}(K=f==null?void 0:f.proxy)==null||K.$forceUpdate(),s.actionSpan=b%X+t(g),B(t(a).actionColOptions||{span:X},i,!0),l("advanced-change",s.isAdvanced)}function T(){s.isAdvanced=!s.isAdvanced}return{handleToggleAdvanced:T,fieldsIsAdvancedMap:D}}function Pe(s){return it.includes(s)}function Ft(s,l={}){const a=/^\[(.+)\]$/;if(a.test(s)){const c=s.match(a);if(c&&c[1]){const v=c[1].split(",");if(!v.length)return;const y=[];return v.forEach((f,F)=>{ee(y,F,l[f.trim()])}),y.filter(Boolean).length?y:void 0}}}function bt({emit:s,getProps:l,formModel:a,getSchema:c,defaultValueRef:v,formElRef:y,schemaRef:f,handleFormValues:F}){function u(){return x(this,null,function*(){const{resetFunc:e,submitOnReset:o}=t(l);e&&z(e)&&(yield e()),t(y)&&(Object.keys(a).forEach(n=>{const A=t(c).find(w=>w.field===n),V=A==null?void 0:A.defaultValueObj,P=Object.keys(V||{});P.length&&P.forEach(w=>{a[w]=V[w]}),a[n]=Vt(A,v,n)}),pe(()=>H()),s("reset",Te(a)),o&&W())})}const d=()=>t(c).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function g(e){return x(this,null,function*(){if(Object.keys(e).length===0)return;const o=d(),p=[];o.forEach(n=>{const A=t(c).find(I=>I.field===n),V=Q(e,n),P=ft(e,n),{componentProps:w}=A||{};let C=w;typeof w=="function"&&(C=C({formModel:t(a),formActionType:Z}));let U;const ie=I=>I?C!=null&&C.valueFormat?I:G(I):null;if(j(A==null?void 0:A.component)&&(U=Ft(n,e),U)){const I=U||V;if(Array.isArray(I)){const oe=[];for(const te of I)oe.push(ie(te));t(a)[n]=oe,p.push(n)}else t(a)[n]=ie(I),p.push(n)}if(Pe(A==null?void 0:A.component)){U=Q(V,n);const I=U||V;I&&(J(I)?t(a)[n]=I:typeof I=="string"&&(t(a)[n]=[I])),p.push(n);return}if(P){U=Q(V,n);const I=U||V;t(a)[n]=I,C!=null&&C.onChange&&(C==null||C.onChange(I)),p.push(n)}}),$(p).catch(n=>{})})}function B(e){if(!Array.isArray(e)||Array.isArray(e)&&e.length===0)return;const o=[],p=Object.keys(t(a));p&&(e.forEach(n=>{p.includes(n)&&(o.push(n),t(a)[n]=M(t(Q(v.value,n))))}),$(o).catch(n=>{}))}function D(e){return x(this,null,function*(){const o=M(t(c));if(!e)return;let p=de(e)?[e]:e;de(e)&&(p=[e]);for(const n of p)r(n,o);f.value=o})}function r(e,o){if(de(e)){const p=o.findIndex(n=>n.field===e);p!==-1&&(delete a[e],o.splice(p,1))}}function T(e,o,p=!1){return x(this,null,function*(){const n=M(t(c)),A=Array.isArray(e)?e.map(w=>w.field):[e.field];if(n.find(w=>A.includes(w.field))){ve("There are schemas that have already been added");return}const V=n.findIndex(w=>w.field===o),P=Y(e)?[e]:e;!o||V===-1||p?p?n.unshift(...P):n.push(...P):V!==-1&&n.splice(V+1,0,...P),f.value=n,S(e)})}function i(e){return x(this,null,function*(){let o=[];if(Y(e)&&o.push(e),J(e)&&(o=[...e]),!o.every(n=>fe(n.component)||Reflect.has(n,"field")&&n.field)){ve("All children of the form Schema array that need to be updated must contain the `field` field");return}f.value=o})}function b(e){return x(this,null,function*(){let o=[];if(Y(e)&&o.push(e),J(e)&&(o=[...e]),!o.every(V=>fe(V.component)||Reflect.has(V,"field")&&V.field)){ve("All children of the form Schema array that need to be updated must contain the `field` field");return}const n=[],A=[];t(c).forEach(V=>{const P=o.find(w=>V.field===w.field);if(P){const w=Ke(V,P);A.push(w),n.push(w)}else n.push(V)}),S(A),f.value=dt(n,"field")})}function S(e){let o=[];Y(e)&&o.push(e),J(e)&&(o=[...e]);const p={},n=K();o.forEach(A=>{!fe(A.component)&&Reflect.has(A,"field")&&A.field&&!k(A.defaultValue)&&(!(A.field in n)||k(n[A.field]))&&(p[A.field]=A.defaultValue)}),g(p)}function K(){return t(y)?F(Te(t(a))):{}}function j(e){return Se.includes(e)}function $(e){return x(this,null,function*(){var p;const o=yield(p=t(y))==null?void 0:p.validateFields(e);return F(o)})}function R(e){return x(this,null,function*(){var o;yield(o=t(y))==null?void 0:o.setProps(e)})}function N(e){return x(this,null,function*(){var n;let o;e===void 0?o=d():o=e===Array.isArray(e)?e:void 0;const p=yield(n=t(y))==null?void 0:n.validate(o);return F(p)})}function H(e){return x(this,null,function*(){var o;yield(o=t(y))==null?void 0:o.clearValidate(e)})}function O(e,o){return x(this,null,function*(){var p;yield(p=t(y))==null?void 0:p.scrollToField(e,o)})}function W(e){return x(this,null,function*(){e&&e.preventDefault();const{submitFunc:o}=t(l);if(o&&z(o)){yield o();return}if(t(y))try{const n=yield N();s("submit",n)}catch(n){if((n==null?void 0:n.outOfDate)===!1&&(n!=null&&n.errorFields))return;throw new Error(n)}})}const Z={getFieldsValue:K,setFieldsValue:g,resetFields:u,updateSchema:b,resetSchema:i,setProps:R,removeSchemaByField:D,appendSchemaByField:T,clearValidate:H,validateFields:$,validate:N,submit:W,scrollToField:O};return{handleSubmit:W,clearValidate:H,validate:N,validateFields:$,getFieldsValue:K,updateSchema:b,resetSchema:i,appendSchemaByField:T,removeSchemaByField:D,resetFields:u,setFieldsValue:g,scrollToField:O,resetDefaultField:B}}function Vt(s,l,a){let c=M(l.value[a]);return It(s)?k(c)?void 0:c:(!c&&s&&wt(s)&&(c=[0,0]),!c&&s&&s.component==="ApiTree"&&(c=[]),c)}function wt(s){if(s.component==="Slider"&&s.componentProps&&"range"in s.componentProps)return!0}function It(s){return(s==null?void 0:s.component)&&ot.includes(s.component)}function Tt(v){return x(this,arguments,function*({getSchema:s,getProps:l,formElRef:a,isInitedDefault:c}){qe(()=>x(this,null,function*(){if(t(c)||!t(l).autoFocusFirstItem)return;yield pe();const y=t(s),f=t(a),F=f==null?void 0:f.$el;if(!f||!F||!y||y.length===0)return;const u=y[0];if(!u.component||!u.component.includes("Input"))return;const d=F.querySelector(".ant-row:first-child input");d&&(d==null||d.focus())}))})}const Lt=Je({name:"BasicForm",__name:"BasicForm",props:nt,emits:["advanced-change","reset","submit","register","field-value-change"],setup(s,{expose:l,emit:a}){const c=s,v=a,y=ke(),f=Be({}),F=mt(),u=Be({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),d=se({}),g=se(!1),B=se(),D=se(null),r=se(null),{prefixCls:T}=ct("basic-form"),i=q(()=>L(L({},c),t(B))),b=q(()=>[T,{[`${T}--compact`]:t(i).compact}]),S=q(()=>{const{baseRowStyle:h={},rowProps:_}=t(i);return L({style:h},_)}),K=q(()=>L(L(L({},y),c),t(i))),j=q(()=>{var _;const h=M(t(D)||t(i).schemas);for(const m of h){const{defaultValue:E,component:ne,componentProps:re={},isHandleDateDefaultValue:Re=!0,field:ge,isHandleDefaultValue:Ne=!0,valueFormat:Fe,ifShow:he}=m;if(t(i).showAdvancedButton&&(m.ifshow2=z(he)?he({schema:m,values:f,model:f,field:ge}):he),Re&&E&&ne&&Se.includes(ne)){const He={schema:m,tableAction:(_=c.tableAction)!=null?_:{},formModel:f,formActionType:{}},ce=re?typeof re=="function"?re(He).valueFormat:re.valueFormat:null;if(!Array.isArray(E))m.defaultValue=ce?G(E).format(ce):G(E);else{const be=[];E.forEach(Ve=>{be.push(ce?G(Ve).format(ce):G(Ve))}),m.defaultValue=be}}E&&Pe(m==null?void 0:m.component)&&(J(E)?m.defaultValue=E:typeof E=="string"&&(m.defaultValue=[E])),Ne&&E&&ne&&z(Fe)&&(m.defaultValue=Fe({value:E,schema:m,model:f,field:ge}))}return t(i).showAdvancedButton?h.filter(m=>!fe(m.component)):h}),{handleToggleAdvanced:$,fieldsIsAdvancedMap:R}=gt({advanceState:u,emit:v,getProps:i,getSchema:j,formModel:f,defaultValueRef:d}),{handleFormValues:N,initDefault:H}=vt({getProps:i,defaultValueRef:d,getSchema:j,formModel:f});Tt({getSchema:j,getProps:i,isInitedDefault:g,formElRef:r});const{handleSubmit:O,setFieldsValue:W,clearValidate:Z,validate:e,validateFields:o,getFieldsValue:p,updateSchema:n,resetSchema:A,appendSchemaByField:V,removeSchemaByField:P,resetFields:w,scrollToField:C,resetDefaultField:U}=bt({emit:v,getProps:i,formModel:f,getSchema:j,defaultValueRef:d,formElRef:r,schemaRef:D,handleFormValues:N});st({resetAction:w,submitAction:O}),ae(()=>t(i).model,()=>{const{model:h}=t(i);h&&W(h)},{immediate:!0}),ae(()=>c.schemas,h=>{A(h!=null?h:[])}),ae(()=>j.value,h=>{pe(()=>{var _;(_=F==null?void 0:F.redoModalHeight)==null||_.call(F)}),!t(g)&&h!=null&&h.length&&(H(),g.value=!0)}),ae(()=>f,lt(()=>{t(i).submitOnChange&&O()},300),{deep:!0});function ie(h){return x(this,null,function*(){B.value=Ke(t(B)||{},h)})}function I(h,_,m){f[h]=_,v("field-value-change",h,_),m&&m.itemProps&&!m.itemProps.autoLink&&o([h]).catch(E=>{})}function oe(h){const{autoSubmitOnEnter:_}=t(i);if(_&&h.key==="Enter"&&h.target&&h.target instanceof HTMLElement){const m=h.target;m&&m.tagName&&m.tagName.toUpperCase()==="INPUT"&&O()}}const te={getFieldsValue:p,setFieldsValue:W,resetFields:w,updateSchema:n,resetSchema:A,setProps:ie,removeSchemaByField:P,appendSchemaByField:V,clearValidate:Z,validateFields:o,validate:e,submit:O,scrollToField:C,resetDefaultField:U},Ce=q(()=>L(L({},i.value),u));return l(L({},te)),ze(()=>{H(),v("register",te)}),(h,_)=>(me(),De(t(pt),Ae(K.value,{class:b.value,ref_key:"formElRef",ref:r,model:f,onKeypress:Ze(oe,["enter"])}),{default:le(()=>[_[0]||(_[0]=Qe("1111111111111111111111 ",-1)),Ee(t(ht),Oe(je(S.value)),{default:le(()=>[ue(h.$slots,"formHeader"),(me(!0),Me(et,null,ye(j.value,m=>(me(),De(tt,{key:m.field,isAdvanced:t(R)[m.field],tableAction:h.tableAction,formActionType:te,schema:m,formProps:i.value,allDefaultValues:d.value,formModel:f,setFormModel:I},xe({_:2},[ye(Object.keys(h.$slots),E=>({name:E,fn:le(ne=>[ue(h.$slots,E,Ae({ref_for:!0},ne||{}))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Ee(at,Ae(Ce.value,{onToggleAdvanced:t($)}),xe({_:2},[ye(["resetBefore","submitBefore","advanceBefore","advanceAfter"],m=>({name:m,fn:le(E=>[ue(h.$slots,m,Oe(je(E||{})))])}))]),1040,["onToggleAdvanced"]),ue(h.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model"]))}});export{Lt as _};
