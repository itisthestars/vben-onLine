var Yt=Object.defineProperty,Xt=Object.defineProperties;var Jt=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Zt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable;var nt=(n,a,t)=>a in n?Yt(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t,k=(n,a)=>{for(var t in a||(a={}))Zt.call(a,t)&&nt(n,t,a[t]);if(tt)for(var t of tt(a))Qt.call(a,t)&&nt(n,t,a[t]);return n},ie=(n,a)=>Xt(n,Jt(a));var le=(n,a,t)=>new Promise((s,l)=>{var c=r=>{try{u(t.next(r))}catch(o){l(o)}},f=r=>{try{u(t.throw(r))}catch(o){l(o)}},u=r=>r.done?s(r.value):Promise.resolve(r.value).then(c,f);u((t=t.apply(n,a)).next())});import{d as ce,U as fe,V as P,a0 as we,G as re,k as F,$ as G,u as e,c as T,f as N,w as de,l as Be,J as ye,r as gt,h as mt,o as Xe,y as Ke,ao as en,K as pt,ai as vt,a3 as W,a6 as x,F as tn,a4 as Ve,Y as be,X as ue,W as X,n as Ct,A as St,S as nn,e as an,a8 as at,aj as ot,Z as ze,_ as Le}from"./vue-DdhQyU-d.js";import{_ as on}from"./BasicForm.vue_vue_type_script_setup_true_lang-DsotBgMo.js";import"./BasicForm.vue_vue_type_style_index_0_lang-CCGaOPP2.js";import{a2 as lt,f as Ae,h as xe,I as Ue,X as ln,a3 as sn,E as cn,H as rn,a4 as un,V as fn,z as st,a5 as yt,a6 as dn,O as hn,c as gn,s as qe,F as mn,q as pn,P as vn}from"./entry/index-DAHXR0BT.js";import"./componentMap-BfomYzjV.js";import{u as Cn}from"./useForm-DdFvvX9h.js";import{aM as Sn,aj as Ce,aN as yn,aO as wn,j as Se,h as J,n as Je,aP as bn,c as _n,aQ as xn,af as ct,o as Ze,T as Fe,aL as Rn,aR as Tn,a5 as Oe,aS as In,a6 as wt,f as it,D as kn,aT as Fn,z as Me,aU as Kn,aB as Pn,aA as An,aG as Dn,aV as bt,d as En}from"./antd-Bp8JzQqk.js";import{a as $n,p as se,b as Ye,u as _t,c as On,d as Bn}from"./TableImg.vue_vue_type_style_index_0_lang-R2GANnDo.js";import{P as Hn,a as Qe,b as Pe,A as je,D as Nn,R as ve,F as zn,u as De,c as Ln}from"./index-CpPkdiC-.js";import{b as rt}from"./uuid-D0SLUWHI.js";import Mn from"./sortable.esm-JiwbClG7.js";const Un={class:"edit-header-cell"},ut=ce({name:"EditTableHeaderIcon",__name:"EditTableHeaderIcon",props:{title:{type:String,default:""}},setup(n){return(a,t)=>(P(),fe("span",Un,[we(a.$slots,"default"),re(" "+G(n.title)+" ",1),F(e(Sn))]))}}),jn=ce({name:"TableHeaderCell",components:{EditTableHeaderCell:ut,BasicHelp:lt},props:{column:{type:Object,default:()=>({})}},setup(n){const{prefixCls:a}=Ae("basic-table-header-cell"),t=T(()=>{var c;return!!((c=n.column)!=null&&c.edit)}),s=T(()=>{var f;const c=n.column;return typeof c.customHeaderRender=="function"?c.customHeaderRender(c):(c==null?void 0:c.customTitle)||((f=n.column)==null?void 0:f.title)}),l=T(()=>{var c;return(c=n.column)==null?void 0:c.helpMessage});return()=>F("div",null,[t.value?F(ut,null,{default:()=>[s.value]}):F("span",{class:"default-header-cell"},[s.value]),l.value&&F(lt,{text:l.value,class:`${a}__help`},null)])}});function Gn({page:n,type:a,originalElement:t}){return a==="prev"?n===0?null:Be(yn):a==="next"?n===1?null:Be(wn):t}function Wn(n){const{t:a}=xe(),t=N({}),s=N(!0);de(()=>e(n).pagination,o=>{!Ce(o)&&o&&(t.value=k(k({},e(t)),o!=null?o:{}))});const l=T(()=>{const{pagination:o}=e(n);return!e(s)||Ce(o)&&!o?!1:k(k({current:1,size:"small",defaultPageSize:Qe,showTotal:y=>a("component.table.total",{total:y}),showSizeChanger:!0,pageSizeOptions:Hn,itemRender:Gn,showQuickJumper:!0},Ce(o)?{}:o),e(t))});function c(o){const y=e(l);t.value=k(k({},Ce(y)?{}:y),o)}function f(){return e(l)}function u(){return e(s)}function r(o){return le(this,null,function*(){s.value=o})}return{getPagination:f,getPaginationInfo:l,setShowPagination:r,getShowPagination:u,setPagination:c}}function qn(n){return({text:a,record:t,index:s})=>(ye(t).onValid=()=>le(this,null,function*(){if(Ue(t==null?void 0:t.validCbs)){const l=((t==null?void 0:t.validCbs)||[]).map(f=>f());return(yield Promise.all(l)).every(f=>!!f)}else return!1}),ye(t).onEdit=(l,c=!1)=>le(this,null,function*(){var f,u;return c||(t.editable=l),!l&&c?(yield t.onValid())&&(yield(f=t.onSubmitEdit)==null?void 0:f.call(t))?(t.editable=!1,!0):!1:(!l&&!c&&((u=t.onCancelEdit)==null||u.call(t)),!0)}),Be($n,{value:a,record:t,column:n,index:s}))}function xt(n,a){const{key:t,dataIndex:s,children:l}=n;n.align=n.align||Nn,a&&(t||(n.key=typeof s=="object"?s.join("-"):s),Ce(n.ellipsis)||Object.assign(n,{ellipsis:a})),l&&l.length&&Rt(l,!!a)}function Rt(n,a){n&&n.forEach(t=>{const{children:s}=t;xt(t,a),Rt(s,a)})}function Vn(n,a,t){const{t:s}=xe(),{showIndexColumn:l,indexColumnProps:c,isTreeTable:f}=e(n);let u=!1;if(e(f)||(t.forEach(()=>{const o=t.findIndex(y=>y.flag===Pe);l?u=o===-1:!l&&o!==-1&&t.splice(o,1)}),!u))return;const r=t.some(o=>o.fixed==="left");t.unshift(k(k({flag:Pe,width:60,title:s("component.table.index"),align:"center",customRender:({index:o})=>{const y=e(a);if(Ce(y))return`${o+1}`;const{current:I=1,pageSize:L=Qe}=y;return((I<1?1:I)-1)*L+o+1}},r?{fixed:"left"}:{}),c))}function Yn(n,a){const{actionColumn:t}=e(n);if(!t)return;const s=a.findIndex(l=>l.flag===je);s===-1&&a.push(ie(k(ie(k({},a[s]),{fixed:"right"}),t),{flag:je}))}function Xn(n,a){const t=N(e(n).columns);let s=e(n).columns;const l=T(()=>{const S=Se(e(t));if(Vn(n,a,S),Yn(n,S),!S)return[];const{ellipsis:g}=e(n);return S.forEach(i=>{const{customRender:h,slots:p}=i;xt(i,Reflect.has(i,"ellipsis")?!!i.ellipsis:!!g&&!h&&!p)}),S});function c(S){const g=S.ifShow;let i=!0;return Ce(g)&&(i=g),J(g)&&(i=g(S)),i}const{hasPermission:f}=ln(),u=T(()=>{const S=ft(e(l)),g=h=>{const{slots:p,customRender:C,format:_,edit:$,editRow:O,flag:A}=h;(!p||!(p!=null&&p.title))&&(h.customTitle=h.title);const j=[Pe,je].includes(A);return!C&&_&&!$&&!j&&(h.customRender=({text:U,record:Q,index:he})=>Jn(U,_,Q,he)),($||O)&&!j&&(h.customRender=qn(h)),gt(h)};return Se(S).filter(h=>f(h.auth)&&c(h)).map(h=>{var p;return(p=h.children)!=null&&p.length&&(h.children=h.children.map(g)),g(h)})});de(()=>e(n).columns,S=>{var g;t.value=S,s=(g=S==null?void 0:S.filter(i=>!i.flag))!=null?g:[]});function r(S,g){!S||!g||s.forEach(i=>{if(i.dataIndex===S){Object.assign(i,g);return}})}function o(S){const g=Se(S);if(!Ue(g))return;if(g.length<=0){t.value=[];return}const i=g[0],h=s.map(p=>p.dataIndex);if(!Je(i)&&!Ue(i))t.value=g;else{const p=g.map(_=>_.toString()),C=[];s.forEach(_=>{var $;C.push(ie(k({},_),{defaultHidden:!p.includes((($=_.dataIndex)==null?void 0:$.toString())||_.key)}))}),_n(h,g)||C.sort((_,$)=>{var O,A;return p.indexOf((O=_.dataIndex)==null?void 0:O.toString())-p.indexOf((A=$.dataIndex)==null?void 0:A.toString())}),t.value=C}}function y(S){const{ignoreIndex:g,ignoreAction:i,sort:h}=S||{};let p=ye(e(l));return g&&(p=p.filter(C=>C.flag!==Pe)),i&&(p=p.filter(C=>C.flag!==je)),h&&(p=ft(p)),p}function I(){return s}function L(S){Ue(S)&&(s=S.filter(g=>!g.flag))}function z(S,g){g.width=S}return{getColumnsRef:l,getCacheColumns:I,getColumns:y,setColumns:o,setColumnWidth:z,getViewColumns:u,setCacheColumnsByField:r,setCacheColumns:L}}function ft(n){const a=[],t=[],s=[];for(const u of n){if(u.fixed==="left"){a.push(u);continue}if(u.fixed==="right"){t.push(u);continue}s.push(u)}const l=u=>!u.defaultHidden,c=[...a,...s,...t].filter(l),f=[...c];for(;f.length;){const u=f[0];Array.isArray(u.children)?(u.children=u.children.filter(l),f.shift(),f.unshift(...u.children)):f.shift()}return c}function Jn(n,a,t,s){if(!a)return n;if(J(a))return a(n,t,s);try{const l="date|";if(Je(a)&&a.startsWith(l)&&n){const c=a.replace(l,"");return c?sn(n,c):n}if(bn(a))return a.get(n)}catch(l){return n}}function Zn(n,{getPaginationInfo:a,setPagination:t,setLoading:s,getFieldsValue:l,clearSelectedRowKeys:c,tableData:f},u){const r=gt({sortInfo:{},filterInfo:{}}),o=N([]),y=N({}),I=N({});mt(()=>{f.value=e(o)}),de(()=>e(n).dataSource,()=>{const{dataSource:v,api:b}=e(n);!b&&v&&(o.value=v)},{immediate:!0});function L(v,b,D){const{clearSelectOnPageChange:B,sortFn:H,filterFn:V}=e(n);B&&c(),t(v);const K={};if(D&&J(H)){const Y=H(D);r.sortInfo=Y,K.sortInfo=Y}if(b&&J(V)){const Y=V(b);r.filterInfo=Y,K.filterInfo=Y}O(K)}function z(v){!v||!Array.isArray(v)||v.forEach(b=>{b[ve]||(b[ve]=rt()),b.children&&b.children.length&&z(b.children)})}const S=T(()=>e(n).autoCreateKey&&!e(n).rowKey),g=T(()=>{const{rowKey:v}=e(n);return e(S)?ve:v}),i=N([]);de(()=>o.value,()=>{const v=e(o);if((!v||v.length===0)&&(i.value=e(o)),e(S)){const b=v[0],D=v[v.length-1];if(b&&D&&(!b[ve]||!D[ve])){const B=Se(e(o));B.forEach(H=>{H[ve]||(H[ve]=rt()),H.children&&H.children.length&&z(H.children)}),o.value=B}}i.value=e(o)},{deep:!0,immediate:!0});function h(v,b,D){return le(this,null,function*(){return o.value[v]&&(o.value[v][b]=D),o.value[v]})}function p(v,b){const D=$(v);if(D){for(const B in D)Reflect.has(b,B)&&(D[B]=b[B]);return D}}function C(v){var B;if(!o.value||o.value.length==0)return;const b=Array.isArray(v)?v:[v];function D(H,V){const K=Y(H,V);if(K===null||K.index===-1)return;K.data.splice(K.index,1);function Y(ee,ge){var me;if(ee==null)return null;for(let te=0;te<ee.length;te++){const ne=ee[te];if(se(e(g),ne)===ge)return{index:te,data:ee};if(((me=ne.children)==null?void 0:me.length)>0){const pe=Y(ne.children,ge);if(pe!=null)return pe}}return null}}for(const H of b)D(o.value,H),D(e(n).dataSource,H);t({total:(B=e(n).dataSource)==null?void 0:B.length})}function _(v,b){var B;b=b!=null?b:(B=o.value)==null?void 0:B.length;const D=rn(v)?[v]:v;return e(o).splice(b,0,...D),e(o)}function $(v){if(!o.value||o.value.length===0)return;const{childrenColumnName:b="children"}=e(n);return(B=>{let H;return B.some(function V(K){return se(e(g),K)===v?(H=K,!0):K[b]&&K[b].some(V)}),H})(o.value)}function O(v){return le(this,null,function*(){var ge,me,te;const{api:b,searchInfo:D,defSort:B,fetchSetting:H,beforeFetch:V,afterFetch:K,useSearchForm:Y,pagination:ee}=e(n);if(!(!b||!J(b)))try{s(!0);const{pageField:ne,sizeField:pe,listField:Re,totalField:Te}=Object.assign({},zn,H);let _e={};const{current:Ie=1,pageSize:ke=Qe}=e(a);Ce(ee)&&!ee||Ce(a)?_e={}:(_e[ne]=v&&v.page||Ie,_e[pe]=ke);const{sortInfo:d={},filterInfo:w}=r;let R=xn(_e,Y?l():{},D,(ge=v==null?void 0:v.searchInfo)!=null?ge:{},B,d,w,(me=v==null?void 0:v.sortInfo)!=null?me:{},(te=v==null?void 0:v.filterInfo)!=null?te:{});V&&J(V)&&(R=(yield V(R))||R),I.value=R;const m=yield b(R);y.value=m;const E=Array.isArray(m);let ae=E?m:ct(m,Re);const oe=E?m.length:ct(m,Te);if(Number(oe)){const He=Math.ceil(oe/ke);if(Ie>He)return t({current:He}),yield O(v)}return K&&J(K)&&(ae=(yield K(ae))||ae),o.value=ae,t({total:oe||0}),v&&v.page&&t({current:v.page||1}),u("fetch-success",{items:e(ae),total:oe}),ae}catch(ne){u("fetch-error",ne),o.value=[],t({total:0})}finally{s(!1)}})}function A(v){o.value=v}function j(){return i.value}function U(){return y.value}function Q(v){return le(this,null,function*(){return yield O(v)})}function he(){return I.value}return Xe(()=>{cn(()=>{e(n).immediate&&O()},16)}),{getDataSourceRef:T(()=>i.value),getDataSource:j,getRawDataSource:U,searchInfoRef:I,getSearchInfo:he,getRowKey:g,setTableData:A,getAutoCreateKey:S,fetch:O,reload:Q,updateTableData:h,updateTableDataRecord:p,deleteTableDataRecord:C,insertTableDataRecord:_,findTableDataRecord:$,handleTableChange:L}}function Qn(n){const a=N(e(n).loading);de(()=>e(n).loading,l=>{a.value=l});const t=T(()=>e(a));function s(l){a.value=l}return{getLoading:t,setLoading:s}}function ea(n,a,t){const s=N([]),l=N([]),c=T(()=>{const{rowSelection:i}=e(n);return i?k({selectedRowKeys:e(s),onChange:(h,p,C)=>{var _,$;if(C)(_=i.onChange)==null||_.call(i,h,p);else{const O=r();for(const A of s.value.filter(j=>O.includes(j)))if(h.findIndex(j=>j===A)<0){const j=s.value.findIndex(U=>U===A);j>-1&&(s.value.splice(j,1),l.value.splice(j,1))}for(const A of h)if(s.value.findIndex(U=>U===A)<0){s.value.push(A);const U=p.find(Q=>se(e(u),Q)===A);U&&l.value.push(U)}o(s.value),($=i.onChange)==null||$.call(i,s.value,l.value)}}},Ze(i,["onChange"])):null});de(()=>{var i;return(i=e(n).rowSelection)==null?void 0:i.selectedRowKeys},i=>{o(i)}),de(()=>e(s),()=>{Ke(()=>{const{rowSelection:i}=e(n);if(i){const{onChange:h}=i;h&&J(h)&&h(z(),S(),!0)}t("selection-change",{keys:z(),rows:S()})})},{deep:!0});const f=T(()=>e(n).autoCreateKey&&!e(n).rowKey),u=T(()=>{const{rowKey:i}=e(n);return e(f)?ve:i});function r(){const{childrenColumnName:i="children"}=e(n),h=[],p=C=>{var _;h.push(se(e(u),C)),(_=C[i])!=null&&_.length&&C[i].forEach(p)};return a.value.forEach(p),h}function o(i){var _;s.value=i||[];const h=ye(e(a)).concat(ye(e(l))),p=un(h,$=>i==null?void 0:i.includes(se(e(u),$)),{children:(_=n.value.childrenColumnName)!=null?_:"children"}),C=[];i==null||i.forEach($=>{const O=p.find(A=>se(e(u),A)===$);O?C.push(O):h[0]&&C.push({[Ye(e(u),h[0])]:$})}),l.value=C}function y(i){l.value=i,s.value=l.value.map(h=>se(e(u),h))}function I(){l.value=[],s.value=[]}function L(i){const p=e(s).findIndex(C=>C===i);p!==-1&&e(s).splice(p,1)}function z(){return e(s)}function S(){return e(l)}function g(){return e(c)}return{getRowSelection:g,getRowSelectionRef:c,getSelectRows:S,getSelectRowKeys:z,setSelectedRowKeys:o,clearSelectedRowKeys:I,deleteSelectRowByKey:L,setSelectedRows:y}}function ta(n,a){let t;function s(c){return le(this,null,function*(){var r;const{id:f}=c,u=t==null?void 0:t.querySelector(`[data-row-key="${f}"]`);yield Ke(),t==null||t.scrollTo({top:(r=u==null?void 0:u.offsetTop)!=null?r:0,behavior:"smooth"})})}function l(c){const f=e(n);if(!f)return;const u=f.$el;if(!u||!t&&(t=u.querySelector(".ant-table-body"),!t))return;const r=e(a);if(r)if(c==="top")s(r[0]);else if(c==="bottom")s(r[r.length-1]);else{const o=r.find(y=>y.id===c);o&&s(o)}}return{scrollTo:l}}function na(n,{setSelectedRowKeys:a,getSelectRowKeys:t,getAutoCreateKey:s,clearSelectedRowKeys:l,emit:c}){return{customRow:(u,r)=>({onClick:o=>{o==null||o.stopPropagation();function y(){var p;const{rowSelection:I,rowKey:L,clickToRowSelect:z}=e(n);if(!I||!z)return;const S=t()||[],g=se(L,u,e(s));if(!g)return;if(I.type==="checkbox"){const C=(p=o.composedPath)==null?void 0:p.call(o).find(O=>O.tagName==="TR");if(!C)return;const _=C.querySelector("input[type=checkbox]");if(!_||_.hasAttribute("disabled"))return;if(!S.includes(g)){S.push(g),a(S);return}const $=S.findIndex(O=>O===g);S.splice($,1),a(S);return}if(I.type==="radio"){if(!S.includes(g)){S.length&&l(),a([g]);return}l()}}y(),c("row-click",u,r,o)},onDblclick:o=>{c("row-dbClick",u,r,o)},onContextmenu:o=>{c("row-contextmenu",u,r,o)},onMouseenter:o=>{c("row-mouseenter",u,r,o)},onMouseleave:o=>{c("row-mouseleave",u,r,o)}})}}function aa(n,a){function t(s,l){const{striped:c,rowClassName:f}=e(n),u=[];return c&&u.push((l||0)%2===1?`${a}-row__striped`:""),f&&J(f)&&u.push(f(s,l)),u.filter(r=>!!r).join(" ")}return{getRowClassName:t}}const oa=["data-no"],la=ce({name:"ColumnSetting",__name:"ColumnSetting",props:{cache:{type:Boolean,default:()=>!1}},emits:["columns-change"],setup(n,{emit:a}){const t=_t(),s=a,l=en(),{t:c}=xe(),{prefixCls:f}=Ae("basic-column-setting"),u=pt(),r=De(),o=n,y=()=>J(u.getPopupContainer)?u.getPopupContainer():yt();let I=!1,L=!1,z,S=[],g=!1,i=!1;const h=N([]),p=N(null),C=N([]);de(C,()=>{g&&(h.value.filter(d=>C.value.includes(d.value)).forEach(d=>{d.column.defaultHidden=!1}),h.value.filter(d=>!C.value.includes(d.value)).forEach(d=>{d.column.defaultHidden=!0,d.fixed=void 0}),te(),K(),o.cache&&he())});const _=N(!1),$=()=>{C.value.length<h.value.length?C.value=h.value.map(d=>d.value):C.value=[]},O=T(()=>C.value.length>0&&C.value.length<h.value.length),A=N(!1),j=d=>{ne(d.target.checked),o.cache&&typeof l.name=="string"&&t.setShowIndexColumn(l.name,d.target.checked)},U=N(!1),Q=d=>{pe(d.target.checked),o.cache&&typeof l.name=="string"&&t.setShowRowSelection(l.name,d.target.checked)},he=()=>{typeof l.name=="string"&&t.setColumns(l.name,h.value)},v=()=>{A.value=I,j({target:{checked:I}}),U.value=L,Q({target:{checked:L}}),h.value=Se(S),Re()},b=(d,w)=>{w==="left"?!d.fixed||d.fixed==="right"?d.fixed="left":d.fixed=void 0:w==="right"&&(!d.fixed||d.fixed==="left"?d.fixed="right":d.fixed=void 0),K(),o.cache&&he()},D=()=>le(this,null,function*(){if(p.value){const d=p.value.$el;Array.from(d.children).forEach(w=>d.removeChild(w))}yield Ke()}),B=d=>{if(d){if("ifShow"in d){if(typeof d.ifShow=="boolean")return d.ifShow;if(d.ifShow)return d.ifShow(d)}return!0}return!1},H=()=>r.getColumns({ignoreIndex:!0,ignoreAction:!0}).filter(d=>B(d)),V=d=>{i=!0,r==null||r.setColumns(d);const w=d.map(R=>({dataIndex:R.dataIndex?R.dataIndex.toString():"",fixed:R.fixed,visible:!R.defaultHidden}));s("columns-change",w)},K=()=>{var m;const d=Se(r.getColumns());let w=d.filter(E=>E.flag!==Pe&&(E.fixed==="left"||E.fixed===!0)).length;A.value&&w++;for(const E of h.value){const ae=d.findIndex(oe=>oe.dataIndex===E.value);if(ae>-1){const oe=d[ae];oe.defaultHidden=(m=E.column)==null?void 0:m.defaultHidden,oe.fixed=E.fixed,d.splice(ae,1),d.splice(w++,0,oe)}}const R=d.findIndex(E=>E.dataIndex==="action");if(R>-1){const E=d.splice(R,1);d.push(E[0])}V(d)},Y=()=>le(this,null,function*(){if(yield Ke(),p.value){const d=p.value.$el;Mn.create(e(d),{animation:500,delay:400,delayOnTouchOnly:!0,handle:".table-column-drag-icon ",dataIdAttr:"data-no",onEnd:w=>{const{oldIndex:R,newIndex:m}=w;if(it(R)||it(m)||R===m)return;const E=Se(h.value);R>m?(E.splice(m,0,E[R]),E.splice(R+1,1)):(E.splice(m+1,0,E[R]),E.splice(R,1)),h.value=E,K(),o.cache&&he()}})}}),ee=()=>{if(typeof l.name=="string"){let d=t.getColumns(l.name);if(d&&JSON.stringify(h.value.map(w=>({value:w.value,label:w.label})))!==JSON.stringify(d.map(w=>({value:w.value,label:w.label})))){const w=h.value.reduce((R,m)=>(R[m.value]=m.label,R),{});if(Array.isArray(d)){d=d.filter(m=>w[m.value]),d.forEach(m=>{m.label=w[m.value]});const R=d.map(m=>m.value);d=d.concat(h.value.filter(m=>!R.includes(m.value))),t.setColumns(l.name,d)}}}},ge=()=>{if(typeof l.name=="string"){const d=t.getShowIndexColumn(l.name);typeof d=="boolean"&&(A.value=I&&d);const w=t.getShowRowSelection(l.name);typeof w=="boolean"&&(U.value=L&&w)}if(j({target:{checked:A.value}}),Q({target:{checked:U.value}}),typeof l.name=="string"){const d=t.getColumns(l.name);Array.isArray(d)&&(h.value=d)}},me=()=>{C.value=h.value.filter(d=>{var w;return!((w=d.column)!=null&&w.defaultHidden)}).map(d=>d.value)},te=()=>{_.value=h.value.length===C.value.length},ne=d=>{i=!0,r.setProps({showIndexColumn:d})},pe=d=>{i=!0,r.setProps({rowSelection:d?ie(k({},Ze(z,["selectedRowKeys"])),{fixed:!0}):void 0})},Re=()=>{me(),te(),ne(A.value),pe(U.value),K()},Te=()=>le(this,null,function*(){var d;if(!g){const w=H();(d=r.setCacheColumns)==null||d.call(r,w);const R=[];for(const m of w)R.push({label:typeof m.title=="string"?m.title:typeof m.customTitle=="string"?m.customTitle:"",value:typeof m.dataIndex=="string"?m.dataIndex:typeof m.title=="string"?m.title:"",column:{defaultHidden:m.defaultHidden},fixed:m.fixed});I=r.getBindValues.value.showIndexColumn||!1,z=r.getRowSelection(),L=!!z,S=R,A.value=I,U.value=L,h.value=Se(R),o.cache&&ee(),o.cache&&ge(),Re(),g=!0}});le(this,null,function*(){yield D(),Te()});const Ie=T(()=>r==null?void 0:r.getColumns()),ke=T(()=>r==null?void 0:r.getBindValues);return Xe(()=>{de([Ie,ke],()=>{i?i=!1:(g=!1,Te())})}),(d,w)=>{const R=vt("a-button");return P(),W(e(Fe),{placement:"top"},{title:x(()=>[ue("span",null,G(e(c)("component.table.settingColumn")),1)]),default:x(()=>[F(e(Rn),{placement:"bottomLeft",trigger:"click",onOpenChange:Y,overlayClassName:`${e(f)}__column-list`,getPopupContainer:y},{title:x(()=>[ue("div",{class:be(`${e(f)}__popover-title`)},[F(e(Oe),{indeterminate:O.value,checked:_.value,"onUpdate:checked":w[0]||(w[0]=m=>_.value=m),onChange:$},{default:x(()=>[re(G(e(c)("component.table.settingColumnShow")),1)]),_:1},8,["indeterminate","checked"]),F(e(Oe),{checked:A.value,"onUpdate:checked":w[1]||(w[1]=m=>A.value=m),onChange:j},{default:x(()=>[re(G(e(c)("component.table.settingIndexColumnShow")),1)]),_:1},8,["checked"]),e(L)?(P(),W(e(Oe),{key:0,checked:U.value,"onUpdate:checked":w[2]||(w[2]=m=>U.value=m),onChange:Q},{default:x(()=>[re(G(e(c)("component.table.settingSelectColumnShow")),1)]),_:1},8,["checked"])):X("",!0),F(R,{size:"small",type:"link",onClick:v},{default:x(()=>[re(G(e(c)("common.resetText")),1)]),_:1})],2)]),content:x(()=>[F(e(fn),null,{default:x(()=>[F(e(Oe).Group,{value:C.value,"onUpdate:value":w[3]||(w[3]=m=>C.value=m),ref_key:"columnOptionsRef",ref:p},{default:x(()=>[(P(!0),fe(tn,null,Ve(h.value,m=>(P(),fe("div",{key:m.value,class:be(`${e(f)}__check-item`),"data-no":m.value},[F(e(In),{class:"table-column-drag-icon"}),F(e(Oe),{value:m.value},{default:x(()=>[re(G(m.label),1)]),_:2},1032,["value"]),F(e(Fe),{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:y},{title:x(()=>[re(G(e(c)("component.table.settingFixedLeft")),1)]),default:x(()=>[F(st,{icon:"line-md:arrow-align-left",class:be([`${e(f)}__fixed-left`,{active:m.fixed==="left",disabled:m.value?!C.value.includes(m.value):!0}]),onClick:E=>b(m,"left")},null,8,["class","onClick"])]),_:2},1024),F(e(wt),{type:"vertical"}),F(e(Fe),{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:y},{title:x(()=>[re(G(e(c)("component.table.settingFixedRight")),1)]),default:x(()=>[F(st,{icon:"line-md:arrow-align-left",class:be([`${e(f)}__fixed-right`,{active:m.fixed==="right",disabled:m.value?!C.value.includes(m.value):!0}]),onClick:E=>b(m,"right")},null,8,["class","onClick"])]),_:2},1024)],10,oa))),128))]),_:1},8,["value"])]),_:1})]),default:x(()=>[F(e(Tn))]),_:1},8,["overlayClassName"])]),_:1})}}}),sa=ce({name:"SizeSetting",__name:"SizeSetting",setup(n){const a=_t(),t=De(),{t:s}=xe(),l=N([t.getSize()]),c=({key:f})=>{l.value=[f],a.setTableSize(f),t.setProps({size:f})};return Xe(()=>{l.value=[a.getTableSize],t.setProps({size:l.value[0]})}),(f,u)=>(P(),W(e(Fe),{placement:"top"},{title:x(()=>[ue("span",null,G(e(s)("component.table.settingDens")),1)]),default:x(()=>[F(e(kn),{placement:"bottom",trigger:["click"],getPopupContainer:e(yt)},{overlay:x(()=>[F(e(Me),{onClick:c,selectable:"",selectedKeys:l.value,"onUpdate:selectedKeys":u[0]||(u[0]=r=>l.value=r)},{default:x(()=>[F(e(Me).Item,{key:"default"},{default:x(()=>[ue("span",null,G(e(s)("component.table.settingDensDefault")),1)]),_:1}),F(e(Me).Item,{key:"middle"},{default:x(()=>[ue("span",null,G(e(s)("component.table.settingDensMiddle")),1)]),_:1}),F(e(Me).Item,{key:"small"},{default:x(()=>[ue("span",null,G(e(s)("component.table.settingDensSmall")),1)]),_:1})]),_:1},8,["selectedKeys"])]),default:x(()=>[F(e(Fn))]),_:1},8,["getPopupContainer"])]),_:1}))}}),ca=ce({name:"RedoSetting",__name:"RedoSetting",setup(n){const a=De(),{t}=xe();function s(){a.reload()}return(l,c)=>(P(),W(e(Fe),{placement:"top"},{title:x(()=>[ue("span",null,G(e(t)("common.redo")),1)]),default:x(()=>[F(e(Kn),{onClick:s})]),_:1}))}}),ia=ce({name:"FullScreenSetting",__name:"FullScreenSetting",setup(n){const a=De(),{t}=xe(),{toggle:s,isFullscreen:l}=dn(a.wrapRef);return(c,f)=>(P(),W(e(Fe),{placement:"top"},{title:x(()=>[ue("span",null,G(e(t)("component.table.settingFullScreen")),1)]),default:x(()=>[e(l)?(P(),W(e(An),{key:1,onClick:e(s)},null,8,["onClick"])):(P(),W(e(Pn),{key:0,onClick:e(s)},null,8,["onClick"]))]),_:1}))}}),ra={class:"table-settings"},ua=ce({name:"TableSetting",__name:"index",props:{setting:{type:Object,default:()=>({})}},emits:["columns-change"],setup(n,{emit:a}){const t=n,s=a,l=De(),c=T(()=>k({redo:!0,size:!0,setting:!0,settingCache:!0,fullScreen:!1},t.setting));function f(r){s("columns-change",r)}function u(){return l?e(l.wrapRef):document.body}return(r,o)=>(P(),fe("div",ra,[c.value.redo?(P(),W(ca,{key:0,getPopupContainer:u})):X("",!0),c.value.size?(P(),W(sa,{key:1,getPopupContainer:u})):X("",!0),c.value.setting?(P(),W(la,{key:2,onColumnsChange:f,getPopupContainer:u,cache:c.value.settingCache},null,8,["cache"])):X("",!0),c.value.fullScreen?(P(),W(ia,{key:3,getPopupContainer:u})):X("",!0)]))}}),fa=ce({name:"BasicTableTitle",__name:"TableTitle",props:{title:{type:[Function,String]},getSelectRows:{type:Function},helpMessage:{type:[String,Array]}},setup(n){const a=n,{prefixCls:t}=Ae("basic-table-title"),s=T(()=>{const{title:l,getSelectRows:c=()=>{}}=a;let f=l;return J(l)&&(f=l({selectRows:c()})),f});return(l,c)=>s.value?(P(),W(e(hn),{key:0,class:be(e(t)),helpMessage:n.helpMessage},{default:x(()=>[re(G(s.value),1)]),_:1},8,["class","helpMessage"])):X("",!0)}}),da={key:0},ha={key:1},ga=ce({name:"TableSelectBar",__name:"TableSelectionBar",props:{count:{default:()=>0},clearSelectedRowKeys:{}},setup(n){const{t:a}=xe(),{prefixCls:t}=Ae("table-select-bar"),s=n;return(l,c)=>{const f=vt("a-button");return P(),W(e(Dn),{type:"info",showIcon:"",class:be([e(t)])},{message:x(()=>[s.count>0?(P(),fe("span",da,G(e(a)("component.table.selectionBarTips",{count:s.count})),1)):(P(),fe("span",ha,G(e(a)("component.table.selectionBarEmpty")),1)),Ct(F(f,{type:"link",onClick:n.clearSelectedRowKeys,size:"small"},{default:x(()=>[re(G(e(a)("component.table.selectionBarClear")),1)]),_:1},8,["onClick"]),[[St,s.count>0]])]),_:1},8,["class"])}}}),ma=gn(ga,[["__scopeId","data-v-80ee960a"]]),pa={style:{width:"100%"}},va={key:0,style:{margin:"5px"}},Ca={key:1,style:{margin:"5px"}},Sa={class:"flex items-center"},ya=ce({name:"BasicTableHeader",__name:"TableHeader",props:{title:{type:[Function,String]},tableSetting:{type:Object},showTableSetting:{type:Boolean},titleHelpMessage:{type:[String,Array],default:""},clearSelectedRowKeys:{type:Function},count:{type:Number,default:0},showSelectionBar:{type:Boolean,default:!1}},emits:["columns-change"],setup(n,{emit:a}){const t=n,s=a,{prefixCls:l}=Ae("basic-table-header");function c(f){s("columns-change",f)}return(f,u)=>(P(),fe("div",pa,[f.$slots.headerTop?(P(),fe("div",va,[we(f.$slots,"headerTop")])):X("",!0),n.showSelectionBar?(P(),fe("div",Ca,[F(ma,{clearSelectedRowKeys:t.clearSelectedRowKeys,count:t.count},null,8,["clearSelectedRowKeys","count"])])):X("",!0),ue("div",Sa,[f.$slots.tableTitle?we(f.$slots,"tableTitle",{key:0}):X("",!0),!f.$slots.tableTitle&&n.title?(P(),W(fa,{key:1,helpMessage:n.titleHelpMessage,title:n.title},null,8,["helpMessage","title"])):X("",!0),ue("div",{class:be(`${e(l)}__toolbar`)},[we(f.$slots,"toolbar"),f.$slots.toolbar&&n.showTableSetting?(P(),W(e(wt),{key:0,type:"vertical"})):X("",!0),n.showTableSetting?(P(),W(ua,{key:1,setting:n.tableSetting,onColumnsChange:c},null,8,["setting"])):X("",!0)],2)])]))}});function wa(n,a,t,s){return{getHeaderProps:T(()=>{const{title:c,showTableSetting:f,titleHelpMessage:u,tableSetting:r,showSelectionBar:o}=e(n),y=!a.tableTitle&&!c&&!a.toolbar&&!f;return y&&!Je(c)?{}:{title:y?null:()=>Be(ya,{title:c,titleHelpMessage:u,showTableSetting:f,tableSetting:r,onColumnsChange:t.onColumnsChange,clearSelectedRowKeys:s.clearSelectedRowKeys,count:s.getSelectRowKeys().length,showSelectionBar:o},k(k(k({},a.toolbar?{toolbar:()=>qe(a,"toolbar")}:{}),a.tableTitle?{tableTitle:()=>qe(a,"tableTitle")}:{}),a.headerTop?{headerTop:()=>qe(a,"headerTop")}:{}))}})}}function ba(n,a,t){const s=N([]),l=T(()=>e(n).autoCreateKey&&!e(n).rowKey),c=T(()=>{const{rowKey:g}=e(n);return e(l)?ve:g}),f=T(()=>{const{isTreeTable:g,expandRowByClick:i}=e(n);return!g&&!i?{}:{expandedRowKeys:e(s),onExpandedRowsChange:h=>{s.value=h,t("expanded-rows-change",h)}}});function u(){const g=I();s.value=g}function r(){s.value=[]}function o(g){const{isTreeTable:i,expandRowByClick:h}=e(n);!i&&!h||(s.value=[...s.value,...g])}function y(g){const{isTreeTable:i,expandRowByClick:h}=e(n);!i&&!h||(s.value=e(s).filter(p=>!g.includes(p)))}function I(g){const i=[],{childrenColumnName:h}=e(n);return ye(g||e(a)).forEach(p=>{i.push(se(e(c),p));const C=p[h||"children"];C!=null&&C.length&&i.push(...I(C))}),i}function L(g,i,h,p){if(g.findIndex(C=>se(e(c),C)===h)>-1)return p.push(h),!0;for(const C of g){const _=C[i];if(Array.isArray(_)&&L(_,i,h,p))return p.push(se(e(c),C)),!0}return!1}function z(g){const{childrenColumnName:i}=e(n),h=[];L(a.value,i||"children",g,h),s.value=h}function S(g,i){n.value.accordion&&(n.value.isTreeTable||n.value.expandRowByClick)&&g&&Ke(()=>{z(se(e(c),i))})}return{getExpandOption:f,expandAll:u,collapseAll:r,expandRows:o,collapseRows:y,expandRowAccordion:z,handleTableExpand:S}}const dt="_row",ht="_index",_a=ce({name:"BasicTableFooter",__name:"TableFooter",props:{summaryFunc:{default:null},summaryData:{default:null},scroll:{},rowKey:{default:""}},setup(n){const a=n,t=De(),s=T(()=>{var f;if((f=a.summaryData)!=null&&f.length)return a.summaryData.forEach((u,r)=>{u[Ye(a.rowKey,u)]=`${r}`}),a.summaryData;if(!J(a.summaryFunc))return[];let c=ye(e(t.getDataSource()));return c=a.summaryFunc(c),c.forEach((u,r)=>{u[Ye(a.rowKey,u)]=`${r}`}),c}),l=T(()=>{const c=e(s),f=Se(t.getColumns()),u=f.findIndex(y=>y.flag===Pe),r=c.some(y=>Reflect.has(y,dt)),o=c.some(y=>Reflect.has(y,ht));if(u!==-1&&(o?(f[u].customRender=({record:y})=>y[ht],f[u].ellipsis=!1):Reflect.deleteProperty(f[u],"customRender")),t.getRowSelection()&&r){const y=f.some(I=>I.fixed==="left");f.unshift(ie(k({width:60,title:"selection",key:"selectionKey",align:"center"},y?{fixed:"left"}:{}),{customRender:({record:I})=>I[dt]}))}return f});return(c,f)=>a.summaryFunc||a.summaryData?(P(),W(e(bt),{key:0,showHeader:!1,bordered:!1,pagination:!1,dataSource:s.value,rowKey:a.rowKey,columns:l.value,tableLayout:"fixed",scroll:a.scroll},null,8,["dataSource","rowKey","columns","scroll"])):X("",!0)}});function xa(n,a,t,s){const l=T(()=>(e(s)||[]).length===0),c=T(()=>{const{summaryFunc:u,showSummary:r,summaryData:o}=e(n);return r&&!e(l)?()=>Be(_a,{summaryFunc:u,summaryData:o,scroll:e(a)}):void 0});mt(()=>{f()});function f(){const{showSummary:u}=e(n);!u||e(l)||Ke(()=>{const r=e(t);if(!r)return;const o=r.$el.querySelector(" .ant-table-content,  .ant-table-body");mn({el:o,name:"scroll",listener:()=>{const y=r.$el.querySelector('.ant-table-footer .ant-table-container  [class^="ant-table-"]');!y||!o||(y.scrollLeft=o.scrollLeft)},wait:0,options:!0})})}return{getFooterProps:c}}function Ra(n,a,t,s){const l=T(()=>{const{formConfig:r}=e(n),{submitButtonOptions:o}=r||{};return ie(k({showAdvancedButton:!0},r),{submitButtonOptions:k({loading:e(s)},o),compact:!0})}),c=T(()=>Object.keys(a).map(o=>o.startsWith("form-")?o:null).filter(o=>!!o));function f(r){var o,y;return r&&(y=(o=r==null?void 0:r.replace)==null?void 0:o.call(r,/form-/,""))!=null?y:""}function u(r){const{handleSearchInfoFn:o}=e(n);o&&J(o)&&(r=o(r)||r),t({searchInfo:r,page:1})}return{getFormProps:l,replaceFormSlotKey:f,getFormSlotKeys:c,handleSearchInfoChange:u}}const Ha=ce({name:"BasicTable",__name:"BasicTable",props:On,emits:["fetch-success","fetch-error","selection-change","register","row-click","row-dbClick","row-contextmenu","row-mouseenter","row-mouseleave","edit-end","edit-cancel","edit-row-end","edit-change","expanded-rows-change","change","columns-change"],setup(n,{expose:a,emit:t}){const s=n,l=t,c=pt(),f=nn(),u=N(null),r=N([]),o=N(null),y=N(null),I=N(),{height:L}=pn(o),{prefixCls:z}=Ae("basic-table"),[S,g]=Cn(),i=T(()=>k(k({},s),e(I))),h=an(vn,!1),{getLoading:p,setLoading:C}=Qn(i),{getPaginationInfo:_,getPagination:$,setPagination:O,setShowPagination:A,getShowPagination:j}=Wn(i),{getRowSelection:U,getRowSelectionRef:Q,getSelectRows:he,setSelectedRows:v,clearSelectedRowKeys:b,getSelectRowKeys:D,deleteSelectRowByKey:B,setSelectedRowKeys:H}=ea(i,r,l),{handleTableChange:V,getDataSourceRef:K,getDataSource:Y,getRawDataSource:ee,getSearchInfo:ge,setTableData:me,updateTableDataRecord:te,deleteTableDataRecord:ne,insertTableDataRecord:pe,findTableDataRecord:Re,fetch:Te,getRowKey:_e,reload:Ie,getAutoCreateKey:ke,updateTableData:d}=Zn(i,{tableData:r,getPaginationInfo:_,setLoading:C,setPagination:O,getFieldsValue:g.getFieldsValue,clearSelectedRowKeys:b},l);function w(M,Z,q,$e){V(M,Z,q),l("change",M,Z,q);const{onChange:We}=e(i);We&&J(We)&&We(M,Z,q,$e)}const{getViewColumns:R,getColumns:m,setCacheColumnsByField:E,setCacheColumns:ae,setColumnWidth:oe,setColumns:He,getColumnsRef:Tt,getCacheColumns:It}=Xn(i,_),{getScrollRef:et,redoHeight:Ge}=Bn(i,u,Tt,Q,K,o,y),kt=En(Ge,50),{scrollTo:Ft}=ta(u,K),{customRow:Kt}=na(i,{setSelectedRowKeys:H,getSelectRowKeys:D,clearSelectedRowKeys:b,getAutoCreateKey:ke,emit:l}),{getRowClassName:Pt}=aa(i,z),{getExpandOption:At,expandAll:Dt,expandRows:Et,collapseRows:$t,collapseAll:Ot,handleTableExpand:Bt}=ba(i,r,l),Ht={onColumnsChange:M=>{var Z,q;l("columns-change",M),(q=(Z=e(i)).onColumnsChange)==null||q.call(Z,M)}},Nt={clearSelectedRowKeys:b,getSelectRowKeys:D},{getHeaderProps:zt}=wa(i,f,Ht,Nt),{getFooterProps:Lt}=xa(i,et,u,K),{getFormProps:Mt,replaceFormSlotKey:Ut,getFormSlotKeys:jt,handleSearchInfoChange:Gt}=Ra(i,f,Te,p),Ee=T(()=>{const M=e(K);let Z=k(ie(k(k(ie(k({},c),{customRow:Kt}),e(i)),e(zt)),{scroll:e(et),loading:e(p),tableLayout:"fixed",rowSelection:e(Q),rowKey:e(_e),columns:ye(e(R)),pagination:ye(e(_)),dataSource:M,footer:e(Lt)}),e(At));return Z=Ze(Z,["class","onChange"]),Z}),Wt=T(()=>{const M=e(Ee);return[z,c.class,{[`${z}-form-container`]:M.useSearchForm,[`${z}--inset`]:M.inset}]}),qt=T(()=>{const{emptyDataIsShowTable:M,useSearchForm:Z}=e(i);return M||!Z?!0:!!e(K).length});de(L,()=>{e(h)&&s.canResize&&kt()});function Vt(M){I.value=k(k({},e(I)),M)}const Ne={reload:Ie,getSelectRows:he,setSelectedRows:v,clearSelectedRowKeys:b,getSelectRowKeys:D,deleteSelectRowByKey:B,setPagination:O,setTableData:me,updateTableDataRecord:te,deleteTableDataRecord:ne,insertTableDataRecord:pe,findTableDataRecord:Re,redoHeight:Ge,setSelectedRowKeys:H,setColumns:He,setLoading:C,getDataSource:Y,getRawDataSource:ee,getSearchInfo:ge,setProps:Vt,getRowSelection:U,getPaginationRef:$,getColumns:m,getCacheColumns:It,emit:l,updateTableData:d,setShowPagination:A,getShowPagination:j,setCacheColumnsByField:E,expandAll:Dt,collapseAll:Ot,expandRows:Et,collapseRows:$t,scrollTo:Ft,getSize:()=>e(Ee).size,setCacheColumns:ae};return Ln(ie(k({},Ne),{wrapRef:o,getBindValues:Ee})),l("register",Ne,g),a(k({tableElRef:u},Ne)),(M,Z)=>(P(),fe("div",{ref_key:"wrapRef",ref:o,class:be(Wt.value)},[Ee.value.useSearchForm?(P(),W(e(on),at({key:0,ref_key:"formRef",ref:y,submitOnReset:""},e(Mt),{tableAction:Ne,onRegister:e(S),onSubmit:e(Gt),onAdvancedChange:e(Ge)}),ot({_:2},[Ve(e(jt),q=>({name:e(Ut)(q),fn:x($e=>[we(M.$slots,q,ze(Le($e||{})))])}))]),1040,["onRegister","onSubmit","onAdvancedChange"])):X("",!0),Ct(F(e(bt),at({ref_key:"tableElRef",ref:u},Ee.value,{rowClassName:e(Pt),onChange:w,onResizeColumn:e(oe),onExpand:e(Bt)}),ot({headerCell:x(({column:q})=>[we(M.$slots,"headerCell",ze(Le({column:q})),()=>[F(jn,{column:q},null,8,["column"])])]),bodyCell:x(q=>[we(M.$slots,"bodyCell",ze(Le(q||{})))]),_:2},[Ve(Object.keys(M.$slots),q=>({name:q,fn:x($e=>[we(M.$slots,q,ze(Le($e||{})))])}))]),1040,["rowClassName","onResizeColumn","onExpand"]),[[St,qt.value]])],2))}});export{Ha as _,jn as a};
